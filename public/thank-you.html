<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- title ç”±ä¸‹æ–¹ JS å‹•æ…‹è¨­å®š -->
  <title id="pageTitle"></title>
 
  <!-- ç«™å…§å…±ç”¨æ¨£å¼ -->
  <link rel="stylesheet" href="/src/main.css" />

  <!-- 1. Firebase Compat: å¿…é ˆæœ€å…ˆè¼‰å…¥ -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth-compat.js"></script>

  <!-- 2. Headerï¼ˆè£¡é¢æœƒç”¨åˆ° firebaseï¼‰ -->
  <script type="module" src="/js/app-header.js"></script>
</head>

<body class="star-bg">
  <div id="appHeader"></div>

  <main class="page-container fade-in">
    <img src="img/network.png"
         alt="Network Illustration: äººéš›é€£çµ"
         class="network"
         loading="lazy"
         decoding="async" />

    <h1 id="title" class="thanks-title"></h1>
    <p id="thanksText" class="thanks-message"></p>

    <div id="summaryArea" class="summary-link">
      <a id="summaryLink" href="recommend-summary.html" target="_blank"></a>
    </div>

    <div class="next-action-card fadeUp">
      <p id="inviteText"></p>
      <a href="#" id="startFresh" class="cta-btn"></a>
      <p id="footerText"
         style="font-size:0.875rem;
                color:var(--color-text-secondary);
                margin-top:12px;"></p>
    </div>
  </main>

  <!-- ========= è¡Œç‚ºè…³æœ¬ ========= -->
  <script type="module">
    import { i18n } from "./js/i18n.js";

    // 1. URL åƒæ•¸
    const urlParams       = new URLSearchParams(location.search);
    const userId          = urlParams.get("userId");
    const style           = urlParams.get("style") || "direct";
    const recommenderName = urlParams.get("recommenderName") || "";
    const recommenderEmail = urlParams.get("recommenderEmail") || "";


    // 2. è®€èªç³»èˆ‡æ–‡æ¡ˆ
    const lang = localStorage.getItem("lang") || "zh-Hant";
    // é€™è£¡çµ±ä¸€ç”¨ thankYou namespaceï¼Œä¸‹æ–¹ key å°æ‡‰ i18n.js çš„ thankYou è£¡é¢
    const t    = i18n[lang].thankYou;

    // 3. å¥—ç”¨æ–‡æ¡ˆ
    document.title                                = t.pageTitle;
    document.getElementById("pageTitle").innerText = t.pageTitle;
    document.getElementById("title").innerText     = t.title;
    document.getElementById("thanksText").innerText= t.message;
    document.getElementById("summaryLink").innerText = t.viewSummary;
    // å–å¾— summaryLink å…ƒç´ 
    const summaryLink = document.getElementById("summaryLink");
    // å°‡ href æ”¹æˆå…¬é–‹æ¨¡å¼çš„ç¶²å€
    summaryLink.href = `recommend-summary.html?public=true&userId=${userId}`;
    // å¦‚æœæƒ³è¦å¾ç¬¬ä¸€ä»½å·¥ä½œé–‹å§‹ï¼Œä¹Ÿå¯åŠ ä¸Š &jobIndex=0
    // summaryLink.href += "&jobIndex=0";

    document.getElementById("footerText").innerText  = t.footer;

    // 4. æ ¹æ“š style åˆ‡æ› CTA æ–‡æ¡ˆ
    if (style === "warmth") {
      document.getElementById("inviteText").innerText = t.warmthThanks;
      document.getElementById("startFresh").innerText = t.warmthStart;
    } else {
      document.getElementById("inviteText").innerText = t.invite;
      document.getElementById("startFresh").innerText = t.start;
    }

    // 5. userId æ¯”å°ï¼Œé¡¯ç¤ºã€ŒæŸ¥çœ‹ç¸½è¡¨ã€
    const profile = JSON.parse(localStorage.getItem("profile") || "{}");
    if (profile.userId === userId) {
      document.getElementById("summaryArea").style.display = "block";
    }

    // 6. CTA æŒ‰éˆ•ï¼šå…ˆå­˜æ¨è–¦äººï¼Œå†å°å‘ç™»å…¥ï¼å»ºç«‹é 
    document.getElementById("startFresh")
      .addEventListener("click", e => {
        e.preventDefault();
        // ğŸ’¾ å·²æœ‰ï¼šå­˜å§“å
        sessionStorage.setItem("prefillName", recommenderName);
        // ğŸ”¥ æ–°å¢ï¼šå­˜ Email
        sessionStorage.setItem("prefillEmail", recommenderEmail);
        // æ¥è‘—å°å‘ç™»å…¥ï¼Œä¿æŒåŸæœ¬çš„ next åƒæ•¸
        location.href = `login.html?next=profile-dashboard.html`;
      });
  </script>

  <!-- confetti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <script>
    window.addEventListener("load", () => {
      setTimeout(() => {
        confetti({ particleCount: 60, spread: 70, origin: { y: 0.25 } });
      }, 600);
    });
  </script>
</body>
</html>
